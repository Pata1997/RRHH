# Agregar estos modelos a app/models.py al final del archivo

# ===================== DETALLE LIQUIDACION =====================
class DetalleLiquidacion(db.Model):
    __tablename__ = 'detalle_liquidaciones'
    
    id = db.Column(db.Integer, primary_key=True)
    liquidacion_id = db.Column(db.Integer, db.ForeignKey('liquidaciones.id'), nullable=False)
    liquidacion = db.relationship('Liquidacion', foreign_keys=[liquidacion_id], backref='detalles')
    
    # Tipo de rubro: 'salario_base', 'ingreso_extra', 'descuento', 'aporte_ips'
    tipo_rubro = db.Column(db.String(50), nullable=False)
    descripcion = db.Column(db.String(255), nullable=False)  # "Salario Base", "Bono", "Descuento IPS", etc.
    monto = db.Column(db.Numeric(12, 2), nullable=False)
    fecha_creacion = db.Column(db.DateTime, default=datetime.utcnow)
    
    def __repr__(self):
        return f'<DetalleLiquidacion {self.liquidacion_id} - {self.tipo_rubro}: {self.monto}>'

# ===================== FAMILIAR EMPLEADO =====================
class FamiliarEmpleado(db.Model):
    __tablename__ = 'familiares_empleado'
    
    id = db.Column(db.Integer, primary_key=True)
    empleado_id = db.Column(db.Integer, db.ForeignKey('empleados.id'), nullable=False)
    empleado = db.relationship('Empleado', foreign_keys=[empleado_id], backref='familiares')
    
    nombre = db.Column(db.String(120), nullable=False)
    parentesco = db.Column(db.String(50), nullable=False)  # hijo, hijasatra, conyugue, etc.
    fecha_nacimiento = db.Column(db.Date)
    rut_cedula = db.Column(db.String(50))
    activo = db.Column(db.Boolean, default=True)
    fecha_creacion = db.Column(db.DateTime, default=datetime.utcnow)
    
    def __repr__(self):
        return f'<FamiliarEmpleado {self.empleado.codigo} - {self.nombre} ({self.parentesco})>'

# ===================== BONIFICACION FAMILIAR =====================
class BonificacionFamiliar(db.Model):
    __tablename__ = 'bonificaciones_familiares'
    
    id = db.Column(db.Integer, primary_key=True)
    empleado_id = db.Column(db.Integer, db.ForeignKey('empleados.id'), nullable=False)
    empleado = db.relationship('Empleado', foreign_keys=[empleado_id], backref='bonificaciones_familiares')
    
    mes = db.Column(db.Integer, nullable=False)
    año = db.Column(db.Integer, nullable=False)
    cantidad_hijos = db.Column(db.Integer, default=0)
    monto_total = db.Column(db.Numeric(12, 2), nullable=False)
    descripcion = db.Column(db.Text)
    fecha_calculo = db.Column(db.DateTime, default=datetime.utcnow)
    
    def __repr__(self):
        return f'<BonificacionFamiliar {self.empleado.codigo} - {self.mes}/{self.año}>'

# ===================== POSTULANTE =====================
class Postulante(db.Model):
    __tablename__ = 'postulantes'
    
    id = db.Column(db.Integer, primary_key=True)
    nombre = db.Column(db.String(120), nullable=False)
    apellido = db.Column(db.String(120), nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)
    telefono = db.Column(db.String(20))
    ci = db.Column(db.String(20), unique=True)
    
    # Cargo al cual aplica
    cargo_id = db.Column(db.Integer, db.ForeignKey('cargos.id'))
    cargo = db.relationship('Cargo', foreign_keys=[cargo_id])
    
    # Estado del postulante
    estado = db.Column(db.String(50), default='Ingresado')  # Ingresado, En evaluación, Entrevistado, Rechazado, Contratado
    
    # Datos adicionales
    resumen_profesional = db.Column(db.Text)
    experiencia_años = db.Column(db.Integer)
    salario_pretendido = db.Column(db.Numeric(12, 2))
    
    # Auditoría
    fecha_postulacion = db.Column(db.DateTime, default=datetime.utcnow)
    fecha_contratacion = db.Column(db.Date)
    
    # Relación a empleado si fue contratado
    empleado_id = db.Column(db.Integer, db.ForeignKey('empleados.id'))
    empleado = db.relationship('Empleado', foreign_keys=[empleado_id])
    
    # Archivos
    documentos = db.relationship('DocumentosCurriculum', backref='postulante', lazy=True, cascade='all, delete-orphan')
    
    def __repr__(self):
        return f'<Postulante {self.nombre} {self.apellido} - {self.estado}>'
    
    @property
    def nombre_completo(self):
        return f'{self.nombre} {self.apellido}'

# ===================== DOCUMENTOS CURRICULUM =====================
class DocumentosCurriculum(db.Model):
    __tablename__ = 'documentos_curriculum'
    
    id = db.Column(db.Integer, primary_key=True)
    postulante_id = db.Column(db.Integer, db.ForeignKey('postulantes.id'), nullable=False)
    
    tipo = db.Column(db.String(50), nullable=False)  # CV, Certificado, Referencia, Otro
    nombre_archivo = db.Column(db.String(255), nullable=False)
    ruta_archivo = db.Column(db.String(255), nullable=False)  # Ruta relativa en uploads/
    contenido = db.Column(db.LargeBinary)  # Almacenar archivo binario si se desea
    descripcion = db.Column(db.Text)
    fecha_carga = db.Column(db.DateTime, default=datetime.utcnow)
    
    def __repr__(self):
        return f'<DocumentosCurriculum {self.postulante_id} - {self.tipo}: {self.nombre_archivo}>'
